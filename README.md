# log4j-CVE-2021-44228-workaround
This project provides a general purpose workaround for the log4j CVE-2021-44228 vulnerability, which can be used in case you do not have the alternative in short term to 
re-build your projects or to patch the log4j-core jars.

The idea behind it is quite simple: 
We force the class loader to load an "empty" version of JndiLookup" class using java runtime "-Xbootclasspath/a" option.
The class is not compatible to the original log4j2 implmentation because this would fail in certain class loading situations.
Therefore when running this you would see the following message:

	"WARN JNDI lookup class is not available because this JRE does not support JNDI. JNDI string lookups will not be available, continuing configuration. Ignoring java.lang.ClassCastException: class org.apache.logging.log4j.core.lookup.JndiLookup".

Log4j2 will continue working without problems never the less, just without using any JNDI lookup - there we go.

To use it just add an "-Xbootclasspath/p" pointing to the directory where you have placed the jar file (e.g. log4j-workaround-1.0-SNAPSHOT.jar) at the beginning of your java command.
The latter could launch anything (Weblgic, Tomcat, fat jar built by spring, ...

To run the proof of concept for example (once you have built it in Maven):
- Go to the "target\log4j-workaround-1.0-SNAPSHOT\WEB-INF" directory in there and run:
	java -Xbootclasspath/a:..\\..\\..\\..\target\\log4j-workaround-1.0-SNAPSHOT.jar -classpath classes;lib\\* com.github.grimch.log4j_workaround.poc.POC

You can also run the POC with Tomcat:
- First the "log4j-workaround-1.0-SNAPSHOT.war" into the tTomcat "webapps" directory.
- In this case rather than modifiying the java command I just set the "CATALINA_OPTS" environment repectively:
- Set CATALINA_OPTS=-Xbootclasspath/a:<path-to-log4j-workaround-1.0-SNAPSHOT.jar>
- Then start tomcat, e.g. using "catalina start".
- Open url http://localhost:8080/log4j-workaround-1.0-SNAPSHOT/POC in your browser.
- Check your terminal or catalina.out for the "WARN JNDI lookup class is not available ..." message.

